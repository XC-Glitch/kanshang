<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æœç´¢ç»“æœ - çœ‹ä¸Š</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:"Microsoft YaHei",Arial,sans-serif}
:root{--primary-color:#fff;--secondary-color:#87E8DE;--secondary-dark:#6BC9BE;--text-color:#333;--light-gray:#f5f5f5;--border-color:#e0e0e0}
body{background:var(--light-gray);color:var(--text-color);line-height:1.6}
.navbar{background:var(--primary-color);border-bottom:1px solid var(--secondary-color);padding:15px 5%;display:flex;justify-content:space-between;align-items:center;position:sticky;top:0;z-index:100;box-shadow:0 2px 5px rgba(0,0,0,.05);flex-wrap:wrap}
.logo{font-size:24px;font-weight:700;color:var(--secondary-color)}
.nav-links{display:flex;list-style:none;flex-wrap:wrap;gap:8px}
.nav-links li{margin-left:0}
.nav-links a{text-decoration:none;color:var(--text-color);font-size:16px;transition:color .3s;padding:4px 8px;display:block}
.nav-links a:hover{color:var(--secondary-dark)}
.search-bar{max-width:600px;margin:40px auto 20px;display:flex;gap:8px;padding:0 20px}
.search-bar input{flex:1;padding:14px 18px;border:1px solid var(--border-color);border-radius:10px;font-size:15px;outline:0}
.search-bar input:focus{border-color:var(--secondary-color)}
.search-bar button{padding:14px 22px;background:var(--secondary-color);color:#fff;border:none;border-radius:10px;cursor:pointer;font-size:15px}
.search-bar button:hover{background:var(--secondary-dark)}
.result-title{text-align:center;margin:0 20px 30px;font-size:18px;color:#555}
.rank-container{max-width:1200px;margin:0 auto 40px;padding:0 20px;display:grid;grid-template-columns:repeat(auto-fill,minmax(190px,1fr));gap:18px}
.tool-card{background:#fff;border-radius:12px;padding:20px;box-shadow:0 2px 10px rgba(0,0,0,.04);border:1px solid var(--border-color);transition:transform .2s}
.tool-card:hover{transform:translateY(-3px)}
.tool-card h3{font-size:16px;margin-bottom:8px;color:#333}
.tool-card .desc{font-size:13px;color:#888;height:36px;overflow:hidden;margin-bottom:12px}
.tool-card .stats{display:flex;justify-content:space-between;font-size:12px;color:#999;margin-bottom:12px}
.tool-card .go{display:inline-block;background:var(--secondary-color);color:#fff;font-size:13px;padding:6px 11px;border-radius:6px;text-decoration:none}
.tool-card .go:hover{background:var(--secondary-dark)}
.empty{text-align:center;grid-column:1/-1;padding:60px 20px;color:#999}
footer{background:var(--secondary-color);color:#fff;text-align:center;padding:25px 0;margin-top:50px}
</style>
</head>
<body>

<div class="navbar">
  <div class="logo">çœ‹ä¸Š</div>
  <ul class="nav-links">
    <li><a href="#" onclick="goType('å·¥å…·')">å·¥å…·</a></li>
    <li><a href="#" onclick="goType('AIå·¥å…·')">AIå·¥å…·</a></li>
    <li><a href="#" onclick="goType('å½±è§†')">å½±è§†</a></li>
    <li><a href="#" onclick="goType('åŠ¨æ¼«')">åŠ¨æ¼«</a></li>
    <li><a href="#" onclick="goType('éŸ³ä¹')">éŸ³ä¹</a></li>
    <li><a href="#" onclick="goType('æ¸¸æˆ')">æ¸¸æˆ</a></li>
    <li><a href="#" onclick="goType('å­¦ä¹ ')">å­¦ä¹ </a></li>
    <li><a href="#" onclick="goType('ç”Ÿæ´»')">ç”Ÿæ´»</a></li>
    <li><a href="#" onclick="goType('èµ„æº')">èµ„æº</a></li>
  </ul>
</div>

<div class="search-bar">
  <input type="text" id="searchInput" placeholder="æœç´¢å·¥å…·åç§°ã€åŠŸèƒ½ã€å…³é”®è¯...">
  <button onclick="goSearch()">æœç´¢</button>
</div>

<div class="result-title" id="resultTitle"></div>
<div class="rank-container" id="cardContainer"></div>

<footer>
  <p>Â© 2026 çœ‹ä¸Š - è®©ç”Ÿæ´»æ›´æ–¹ä¾¿</p>
</footer>

<script src="tool-data.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.38.4/dist/umd/supabase.min.js"></script>

<script>
// ==================== Supabase é…ç½®ï¼ˆæ›¿æ¢ä¸ºä½ çš„å¯†é’¥ï¼‰ ====================
const SUPABASE_URL = "https://yamonzbighacvvehwaad.supabase.co";
const SUPABASE_KEY = "ä½ çš„å®Œæ•´Anon Key"; // æ›¿æ¢ä¸ºè‡ªå·±çš„å®Œæ•´å¯†é’¥
const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

// ==================== ç¼“å­˜ DOM å…ƒç´  ====================
const cardContainer = document.getElementById("cardContainer");
const searchInput = document.getElementById("searchInput");
const resultTitle = document.getElementById("resultTitle");

// ==================== æ ¸å¿ƒé€»è¾‘ ====================
async function initPage() {
  await loadData();
  doFilter();
}

async function loadData() {
  try {
    const { data, error } = await supabase.from('tool_stats').select('id, like_count, view_count');
    if (error) throw error;
    if (data) {
      data.forEach(stat => {
        const tool = toolList.find(t => t.id === stat.id);
        if (tool) {
          tool.like = stat.like_count;
          tool.view = stat.view_count;
        }
      });
    }
  } catch (err) {
    console.warn("åŠ è½½æ•°æ®å¤±è´¥ï¼š", err);
  }
}

async function syncToSupabase(id, type) {
  const tool = toolList.find(t => t.id === id);
  if (!tool) return;

  const updateData = type === 'like' ? { like_count: tool.like } : { view_count: tool.view };
  await supabase.from('tool_stats').update(updateData).eq('id', id);
}

function createToolCard(item) {
  const card = document.createElement("div");
  card.className = "tool-card";
  card.innerHTML = `
    <h3>${item.name}</h3>
    <div class="desc">${item.desc}</div>
    <div class="stats">
      <span class="view-count" data-id="${item.id}">ğŸ‘ï¸ ${item.view}</span>
      <span class="like-count" data-id="${item.id}" style="cursor:pointer">ğŸ‘ ${item.like}</span>
    </div>
    <a href="${item.url}" target="_blank" class="go" data-id="${item.id}">å‰å¾€</a>
  `;

  card.querySelector(".like-count").addEventListener("click", () => {
    item.like++;
    card.querySelector(".like-count").textContent = `ğŸ‘ ${item.like}`;
    syncToSupabase(item.id, 'like');
  });

  card.querySelector(".go").addEventListener("click", () => {
    item.view++;
    card.querySelector(".view-count").textContent = `ğŸ‘ï¸ ${item.view}`;
    syncToSupabase(item.id, 'view');
  });

  return card;
}

function doFilter() {
  const params = new URLSearchParams(location.search);
  const type = params.get("type"); // è·å–åˆ†ç±»å‚æ•°
  const keyword = params.get("q"); // è·å–æœç´¢å…³é”®è¯
  
  // å›å¡«æœç´¢æ¡†
  if (keyword) searchInput.value = keyword;

  let filteredList = [...toolList];
  let titleText = "";

  // åˆ†ç±»ç­›é€‰ï¼ˆæ ¸å¿ƒï¼šåŒ¹é…ä¸­æ–‡åˆ†ç±»åç§°ï¼‰
  if (type) {
    filteredList = filteredList.filter(item => item.type === type);
    titleText = `åˆ†ç±»ï¼š${type}`;
  } 
  // å…³é”®è¯æœç´¢
  else if (keyword) {
    const lowerKeyword = keyword.toLowerCase();
    filteredList = filteredList.filter(item => 
      item.name.toLowerCase().includes(lowerKeyword) || 
      item.desc.toLowerCase().includes(lowerKeyword)
    );
    titleText = `æœç´¢ï¼š${keyword}`;
  }

  // æ›´æ–°æ ‡é¢˜
  resultTitle.textContent = `${titleText}ï¼ˆå…± ${filteredList.length} ä¸ªï¼‰`;
  cardContainer.innerHTML = "";

  // æ— ç»“æœæç¤º
  if (filteredList.length === 0) {
    cardContainer.innerHTML = `<div class="empty">æš‚æ— ç»“æœï¼Œæ¢ä¸ªå…³é”®è¯è¯•è¯•ï½</div>`;
    return;
  }

  // æ¸²æŸ“ç­›é€‰ç»“æœ
  const fragment = document.createDocumentFragment();
  filteredList.forEach(item => fragment.appendChild(createToolCard(item)));
  cardContainer.appendChild(fragment);
}

// ==================== æœç´¢/åˆ†ç±»è·³è½¬ ====================
function goSearch() {
  const q = searchInput.value.trim();
  if (q) location.href = `search.html?q=${encodeURIComponent(q)}`;
}

function goType(type) {
  location.href = `search.html?type=${encodeURIComponent(type)}`;
}

// ==================== åˆå§‹åŒ– ====================
initPage();
</script>

</body>
</html>